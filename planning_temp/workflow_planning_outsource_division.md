# MD Retooling 워크플로우 플래닝 & 외주 분리 계획

> 작성일: 2025-11-30  
> 최종 수정: 2025-11-30  
> 목적: 전체 워크플로우 설계 및 외주(안티그래비티) vs 내부 작업 분리

---

## 🎯 현재 진행 상황 요약

| 항목 | 상태 | 비고 |
|------|------|------|
| **Phase 1 (변환 엔진)** | ✅ 완료 | MVP 가능 |
| **Phase 2 (LLM 연동)** | 🚧 개발중 | - |
| **Phase 2.5 (템플릿 주입)** | 🚧 개발중 | 표 양식 자동입력 |
| **인증 백엔드** | ✅ 완료 | `auth_backend/` |
| **인프라 셋업** | ✅ 완료 | Docker, CI/CD |

### 주요 결정사항
- **PDF/Word 전처리**: LLM-nano (Gemini 2.5 Flash Lite급) 처리 → 외주 불필요
- **외주 범위**: 프론트엔드 UI만 (안티그래비티 강점 활용)
- **외주 착수 시점**: Phase 2.5 완료 후 (API 스펙 확정 필요)
- **인증/결제/인프라**: 내부 개발 (Opus로 가능)

---

## 1. 전체 워크플로우 (End-to-End)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           사용자 입력 레이어                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│  [텍스트 파일]     [PDF]      [Word]      [기존 HWPX 템플릿]                 │
│       │             │           │              │                            │
│       └─────────────┴───────────┴──────────────┘                            │
│                           ↓                                                  │
└─────────────────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                         텍스트 추출/전처리 레이어                             │
├─────────────────────────────────────────────────────────────────────────────┤
│  • PDF → 텍스트: LLM-nano (Gemini 2.5 Flash Lite급)                         │
│  • Word → 텍스트: LLM-nano                                                   │
│  • 텍스트 정규화                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                           LLM 가공 레이어                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│  • Claude/GPT API 연동                                                       │
│  • 텍스트 → 부처 형식 마크다운 변환                                           │
│  • 수동/자동 선택 가능                                                       │
└─────────────────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                         마크다운 생성/편집 레이어                             │
├─────────────────────────────────────────────────────────────────────────────┤
│  • 구조화된 MD 파일 생성                                                     │
│  • 사용자 수동 편집 가능                                                     │
└─────────────────────────────────────────────────────────────────────────────┘
                            ↓
          ┌─────────────────┴─────────────────┐
          ↓                                   ↓
┌─────────────────────────┐     ┌─────────────────────────┐
│   경로 A: MD → HWPX     │     │  경로 B: 템플릿 주입     │
│      변환 엔진          │     │     (Injector)          │
├─────────────────────────┤     ├─────────────────────────┤
│ • 마크다운 파싱         │     │ • HWPX 템플릿 로드       │
│ • HWPX XML 생성         │     │ • {{KEY}} 치환           │
│ • 스타일 적용           │     │ • 리스트/표 확장         │
│ • YAML 스키마 검증      │     │ • 재패키징               │
└─────────────────────────┘     └─────────────────────────┘
          │                                   │
          └─────────────────┬─────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                          HWPX 검증 레이어                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│  • 구조 시각화                                                               │
│  • YAML 스키마 대비 검증                                                     │
│  • Diff 리포트 생성                                                          │
│  • 스타일 확인                                                               │
└─────────────────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                            출력 레이어                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│  • 규격화된 HWPX 문서 생성                                                   │
│  • 다운로드/저장                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                         웹 서비스 레이어 (Phase 4)                           │
├─────────────────────────────────────────────────────────────────────────────┤
│  • 웹 UI (React)                                                             │
│  • 파일 업로드/다운로드                                                      │
│  • 사용자 인증                                                               │
│  • 유료 결제 시스템                                                          │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. Phase별 작업 분해

### Phase 0: 개발 환경 준비 (선행 필수)
| 작업 | 설명 | 상태 |
|------|------|------|
| HWPX 스펙 검색 시스템 | RAG 기반, 40만자 스펙 청크 분할 | 🚧 구현 대기 |
| spec_search.py | 키워드/임베딩 검색 | 📝 예정 |
| chunk_builder.py | 스펙 문서 분할 | 📝 예정 |

### Phase 1: 핵심 변환 엔진 ⭐최우선
| 작업 | 설명 | 상태 |
|------|------|------|
| MD 파서 | 마크다운 구조 분석 | ✅ 완료 |
| HWPX 생성기 | XML 직접 생성 | ✅ 완료 |
| 스타일 시스템 | 폰트/줄간격/정렬 설정 | ✅ 완료 |
| HWPX 검증 툴 | 구조 시각화, 피드백 | ✅ 완료 |

### Phase 1.5: YAML 기반 검증 자동화
| 작업 | 설명 | 상태 |
|------|------|------|
| YAML 스키마 설계 | 최대 8개 필드, 템플릿 정의 | 📝 예정 |
| Validator CLI | 변환 결과 vs YAML 비교 | 📝 예정 |
| Diff 리포트 생성 | 차이점 리포트 출력 | 📝 예정 |

### Phase 2: LLM 자동화
| 작업 | 설명 | 상태 |
|------|------|------|
| Claude/GPT API 연동 | 텍스트 → MD 자동 생성 | 🚧 개발중 |
| 프롬프트 엔지니어링 | 부처별 양식 프롬프트 | 🚧 개발중 |

### Phase 2.5: 템플릿 주입 시스템
| 작업 | 설명 | 상태 |
|------|------|------|
| 템플릿 태깅 | {{KEY}} 플레이스홀더 삽입 | 📝 수동/반자동 |
| Injector (exp_inject.py) | 플레이스홀더 치환 & 재패키징 | ✅ POC 완료 |
| 리스트/표 확장 | 다중 항목 렌더링 | 🚧 개발중 |

### Phase 3: 템플릿 리버스 엔지니어링 (장기)
| 작업 | 설명 | 상태 |
|------|------|------|
| HWPX 구조 분석기 | 샘플 → 구조 자동 추출 | 📝 예정 |
| 변수 자동 탐지 | "___", "OOO" 패턴 인식 | 📝 예정 |
| 코드 자동 생성 | 템플릿 JSON → Python 80% | 📝 예정 |

### Phase 4: 웹 서비스화 (후순위)
| 작업 | 설명 | 상태 |
|------|------|------|
| 인증 백엔드 | JWT 기반 로그인/회원가입 | ✅ 완료 (`auth_backend/`) |
| 인프라 셋업 | Docker, CI/CD | ✅ 완료 |
| 백엔드 API | FastAPI 서버 | 📝 예정 (Phase 2.5 완료 후) |
| 프론트엔드 | React UI | 📝 외주 (안티그래비티) |
| 결제 시스템 | 유료화 | 📝 예정 (사업자등록 후) |

---

## 3. 작업 분리: 외주 vs 내부 (수정됨)

### 3.1 🔵 외주 (안티그래비티 - 프론트엔드만)

> **변경사항:** 백엔드/인프라는 내부 개발, 프론트엔드 UI만 외주

| 작업 | 설명 | 인터페이스/의존성 | 착수 시점 |
|------|------|-------------------|----------|
| **프론트엔드 UI** | React 기반 웹 인터페이스 | API 스펙 문서 필요 | Phase 2.5 완료 후 |
| **파일 업로드/다운로드 UI** | 파일 핸들링 | 백엔드 API 필요 | API 스펙 확정 후 |
| **로그인/회원가입 UI** | 인증 화면 | 인증 API 완료 ✅ | 즉시 가능 |
| **결제 UI** | 결제 화면 | 결제 API 필요 | 사업자등록 후 |
| **관리자 대시보드** | 사용량 통계 | DB 스키마 필요 | 후순위 |

**외주 산출물 (축소됨):**
- 웹 프론트엔드 (React) only

---

### 3.2 🟢 내부 작업 (확대됨)

> **변경사항:** 인증/결제/인프라도 내부 개발 (Opus로 가능)

| 영역 | 작업 | 상태 | 비고 |
|------|------|------|------|
| **핵심 엔진** | MD → HWPX 변환 | ✅ 완료 | Phase 1 |
| **핵심 엔진** | 템플릿 주입 | 🚧 개발중 | Phase 2.5 |
| **핵심 엔진** | LLM 연동 | 🚧 개발중 | Phase 2 |
| **전처리** | PDF/Word → 텍스트 | 📝 예정 | LLM-nano |
| **백엔드** | 인증 API | ✅ 완료 | `auth_backend/` |
| **백엔드** | 변환 API | 📝 예정 | Phase 2.5 완료 후 |
| **백엔드** | 결제 API | 📝 예정 | 사업자등록 후 |
| **인프라** | Docker/CI-CD | ✅ 완료 | - |

---

### 3.3 🟡 협업 영역 (내부 백엔드 ↔ 외주 프론트)

| 작업 | 내부 담당 | 안티그래비티 담당 |
|------|----------|------------------|
| 인증 API | ✅ 완료 (`auth_backend/`) | 로그인/회원가입 UI |
| 변환 API | 설계 + 구현 | 업로드/다운로드 UI |
| 결제 API | 설계 + 구현 | 결제 UI |
| 에러 핸들링 | 에러 코드 정의 | 에러 UI |

---

## 4. 일정 및 우선순위 (수정됨)

```
[완료]        [개발중]              [외주 착수]         [후순위]
   │             │                      │                 │
   ▼             ▼                      ▼                 ▼
Phase 1     Phase 2/2.5           Phase 4 프론트      결제 연동
변환 엔진    LLM + 표 주입          (안티그래비티)      (사업자등록 후)
   │             │                      │
   │             │                      │
인증 백엔드 ─────┼──────────────────────┘
인프라 셋업 ─────┘
```

### 현실적 일정

| 단계 | 기간 | 내부 작업 | 외주 작업 |
|------|------|----------|----------|
| **현재** | - | Phase 2, 2.5 개발중 | - |
| **1단계** | 2-4주 | Phase 2.5 완료 (표 주입) | - |
| **2단계** | 1주 | 변환 API 스펙 확정 | 외주 착수 (인증 UI 먼저) |
| **3단계** | 4-8주 | 변환 API 개발 | 프론트 개발 |
| **4단계** | 2주 | 통합 테스트 | - |
| **5단계** | ? | 결제 API (사업자등록 후) | 결제 UI |

---

## 5. 외주 전달 시 필요 문서 (수정됨)

### 안티그래비티에 전달할 것들

#### 즉시 전달 가능 ✅
1. **인증 API 스펙** (`auth_backend/README.md`)
   - `/auth/register` - 회원가입
   - `/auth/login` - 로그인
   - `/auth/refresh` - 토큰 갱신
   - `/auth/me` - 사용자 정보

#### Phase 2.5 완료 후 전달
2. **변환 API 스펙**
   - `/convert` - MD → HWPX 변환
   - `/inject` - 템플릿 주입

3. **UI/UX 와이어프레임**
   - 주요 화면 흐름
   - 파일 업로드 UI
   - 결과 다운로드 UI

---

## 6. 완료된 산출물

### auth_backend/ (인증 백엔드)
```
auth_backend/
├── main.py                 # FastAPI 앱
├── config.py               # 설정
├── requirements.txt        # 의존성
├── .env.example            # 환경변수 템플릿
├── README.md               # API 문서
├── DEPLOY_GUIDE.md         # 배포 가이드 (바이브코더용)
├── Dockerfile              # Docker 이미지
├── docker-compose.yml      # 프로덕션용
├── docker-compose.dev.yml  # 개발용
├── auth/                   # 인증 모듈
│   ├── router.py           # API 라우터
│   ├── schemas.py          # Pydantic 모델
│   ├── service.py          # 비즈니스 로직
│   ├── jwt_handler.py      # JWT 처리
│   └── dependencies.py     # FastAPI 의존성
├── database/               # DB 모듈
│   ├── connection.py       # DB 연결
│   └── models.py           # User 모델
├── scripts/
│   ├── dev.sh              # 로컬 실행
│   └── deploy.sh           # 수동 배포
└── .github/workflows/
    └── deploy.yml          # GitHub Actions
```

### 인증 API 엔드포인트
| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/auth/register` | 회원가입 |
| POST | `/auth/login` | 로그인 → 토큰 발급 |
| POST | `/auth/refresh` | 토큰 갱신 |
| GET | `/auth/me` | 현재 사용자 정보 |
| POST | `/auth/logout` | 로그아웃 |

---

## 7. 참고사항 / 리스크

### 의존성 주의
- 외주(Phase 4)는 **내부 엔진(Phase 1~2)이 안정화된 후** 시작 권장
- API 스펙이 확정되지 않으면 외주 재작업 발생 가능

### HWP → HWPX 변환
- 자동 변환 도구 불안정 (60% 성공률)
- **사용자가 직접 한컴에서 HWPX로 저장**하는 방식 채택

### 매출 5천만원 전까지
- 고객에게 HWPX 변환 책임 넘기는 것이 현실적

### 결제 연동 주의
- PG사 심사에 **사업자등록증 필요** + 1-2주 소요
- 사업자등록 완료 후에 결제 API 개발 시작

---

## 8. 다음 액션

- [x] ~~Phase 1 현재 진행 상황 파악~~ → 완료 확인
- [x] ~~인증 백엔드 개발~~ → ✅ 완료
- [x] ~~인프라 셋업~~ → ✅ 완료
- [ ] Phase 2.5 완료 (표 주입)
- [ ] 변환 API 스펙 확정
- [ ] 안티그래비티 미팅 (인증 UI 먼저 착수 가능)
- [ ] 사업자등록 → 결제 연동
