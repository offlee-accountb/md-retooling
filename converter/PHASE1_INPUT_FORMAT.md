# Phase1 입력 포맷 및 스타일 요약 (날것 버전)

> 이 문서는 `sample_input.md`와 `style_textbook.md`를 기반으로 한 **현재 단계용 작업 노트**입니다.
> 실제 변환기/결과물이 완성된 뒤, 내용은 검증 결과에 따라 변경될 수 있습니다.

---

## 1. 전역 문서 설정 (타겟 HWPX 기준)

- 용지: A4, 세로, 제본 한쪽
- 여백:
  - 위쪽: 15.0mm
  - 아래쪽: 15.0mm
  - 머리말: 10.0mm
  - 꼬리말: 10.0mm
  - 왼쪽: 20.0mm
  - 오른쪽: 20.0mm
- 줄 격자: 사용 안 함

이 값들은 HWPX 스펙에서 **페이지 설정 관련 요소**로 매핑해야 하며, 세부 XML 구조는 `spec_search.py`로 `pagePr`, `pageMargin` 등 키워드를 검색해 결정한다.

---

## 2. 입력 Markdown 구조 (현재 Phase1 범위)

입력 파일은 `converter/sample_input.md`와 동일한 규칙을 따른다.

- 헤더 기호를 쓰지 않고, **특정 토큰/기호**로 구조를 표현한다.
- 주요 패턴:
  - `<주제목> 텍스트`
  - `□ 텍스트`
  - ` ◦ 텍스트` (앞에 공백 1칸)
  - `   - 텍스트` (앞에 공백 3칸)
  - `    * 텍스트` (앞에 공백 4칸)
  - `<강조> 텍스트`
- 볼드(`**텍스트**`)는 **내용 강조**용이며, 구조 구분은 위 기호들로 한다.

변환기는 각 줄을 파싱하여 **선행 공백 수 + 첫 토큰**으로 라인 타입을 판별해야 한다.

---

## 3. 라인 타입별 규칙 (MD → 논리 역할)

### 3.1 `<주제목>` 라인

- MD 입력 예시:
  - `<주제목> 스마트제조 테스트베드 현황 및 AI 테스트베드 구축 검토 보고`
- 논리 역할: 보고서의 **주제목(타이틀)**

### 3.2 `<소제목>` 라인 (`□`)

- MD 입력 예시:
  - `□ **스마트제조 테스트베드 개요**`
  - `□ **스마트제조 테스트베드 구축 및 운영 현황**`
- 논리 역할: 문단 단위의 **소제목(섹션 헤더)**

### 3.3 `<본문>` 라인 (`◦`)

- MD 입력 예시:
  - ` ◦ **(추진 배경)** ...`
  - ` ◦ **(구성)** ...`
- 논리 역할: 1단계 본문 불릿(주요 설명 문장)

### 3.4 `<설명>` 2단계 라인 (`-`)

- MD 입력 예시:
  - `   - **권역별 스마트공장 테스트베드 구축**: ...`
  - `   - **부산**: ...`
- 논리 역할: 본문을 보충하는 2단계 설명 불릿

### 3.5 `<설명>` 3단계 라인 (`*`)

- MD 입력 예시:
  - (현재 샘플에는 안 나왔지만, 스타일북에서 정의됨)
- 논리 역할: 3단계 보충 설명 불릿

### 3.6 `<강조>` 라인

- MD 입력 예시:
  - `<강조> AI기반 스마트제조혁신 3.0 전략 中 테스트베드 부분`
- 논리 역할: 박스 처리된 강조 문단

---

## 4. 라인 타입별 스타일 규칙 요약

> 아래는 `style_textbook.md`를 그대로 옮긴 **요약 버전**입니다.
> 실제 XML 요소/속성 이름은 Phase1 구현 시 HWPX 스펙을 조회하여 결정합니다.

### 4.1 `<주제목>`

- MD 패턴: `<주제목> (텍스트)`
- 표 구조:
  - 3줄 1칸짜리 표, 테두리 없음
  - 1행, 3행:
    - 너비: 170.00mm
    - 높이: 1.84mm
    - 배경색: 연한 보라 `#EBDEF1`
    - 셀 안 글꼴: 1pt (줄 높이 유지용)
  - 2행:
    - 너비: 170.00mm
    - 높이: 11.20mm
    - 안여백: 좌우 5mm, 상하 0.50mm
    - 배경색: 없음
    - 셀 안 텍스트: `(텍스트)`
- 텍스트 스타일 (2행 기준):
  - 폰트: HY헤드라인M
  - 크기: 15pt
  - 굵게: 전체 Bold
  - 정렬: 센터(가운데)
  - 줄간격: 130%

### 4.2 `<소제목>` (`□`)

- MD 패턴: `□ (텍스트)`
- 텍스트 스타일:
  - 폰트: HY헤드라인M
  - 크기: 15pt
  - 굵게: (입력에 따라, 기본은 소제목이라 Bold가 많은 패턴)
  - 정렬: 좌측
  - 줄간격: 160%
- 특수 규칙 (이전 줄):
  - 바로 위 줄에 "여백 확보용" 한 줄 삽입
  - 폰트: 맑은 고딕
  - 크기: 10pt
  - 내용: 공백 1칸 후 줄바꿈 (시각적 간격 확보 목적)

### 4.3 `<본문>` (`◦`)

- MD 패턴: `◦ (텍스트)` (앞에 공백 1칸)
- 텍스트 스타일:
  - 폰트: 휴먼명조
  - 크기: 15pt
  - 정렬: 좌측
  - 줄간격: 160%
- 특수 규칙 (이전 줄):
  - 폰트: 맑은 고딕
  - 크기: 8pt
  - 내용: 공백 1칸 후 줄바꿈

### 4.4 `<설명>` 2단계 (`-`)

- MD 패턴: `- (텍스트)` (앞에 공백 3칸)
- 텍스트 스타일:
  - 폰트: 휴먼명조
  - 크기: 15pt
  - 정렬: 좌측
  - 줄간격: 160%
- 특수 규칙 (이전 줄):
  - 폰트: 맑은 고딕
  - 크기: 6pt
  - 내용: 공백 1칸 후 줄바꿈

### 4.5 `<설명>` 3단계 (`*`)

- MD 패턴: `* (텍스트)` (앞에 공백 4칸)
- 텍스트 스타일:
  - 폰트: 맑은 고딕
  - 크기: 12pt
  - 정렬: 좌측
  - 줄간격: 160%
- 특수 규칙 (이전 줄):
  - 폰트: 맑은 고딕
  - 크기: 4pt
  - 내용: 공백 1칸 후 줄바꿈

### 4.6 `<강조>`

- MD 패턴: `<강조> (텍스트)`
- 표 구조:
  - 1줄 1칸짜리 표, 테두리 없음
  - 1행:
    - 너비: 170.00mm
    - 높이: 1.84mm
    - 안여백: 좌우 2mm, 상하 2mm
    - 배경색: 연한 노랑 `#FFF7CC`
    - 셀 안 텍스트: `◈ (텍스트)` 형태
- 텍스트 스타일:
  - 폰트: 휴먼명조
  - 크기: 15pt
  - 굵게: 전체 Bold
  - 정렬: 센터(가운데)
  - 줄간격: 130%

---

## 5. Phase1 변환기 설계 골격 (초안)

> 이 부분은 실제 Python 코드 설계 시 참고할 **구조 초안**입니다.
> 구체적인 모듈/함수명과 HWPX XML 구조는 이후 단계에서 확정합니다.

### 5.1 상위 API 초안

- 입력: `input_md_path` (예: `converter/sample_input.md`)
- 출력: `output_hwpx_path` (예: `output/sample_input.hwpx`)
- 개념적 함수 시그니처 예시:

```python
convert_md_to_hwpx(
    input_md_path: Path,
    output_hwpx_path: Path,
    style_config: StyleConfig,
) -> None
```

### 5.2 내부 처리 단계

1. Markdown 라인 파싱
   - 파일을 줄 단위로 읽고, 각 줄에 대해:
     - 선행 공백 수 계산
     - 첫 토큰(`'<주제목>'`, `'□'`, `'◦'`, `'-'`, `'*'`, `'<강조>'`) 식별
     - 볼드 마크다운(`**텍스트**`)은 별도 처리
   - 결과를 내부 AST(예: `Block(type='SUBTITLE', text='...')`) 형태로 보관.

2. 문서 스켈레톤(HWPX) 생성
   - 전역 페이지 설정/여백/격자 설정 적용
   - HWPX 스펙에서 `pagePr`, `secPr` 등에 해당하는 부분은 `spec_search.py`로 확인하여 구현.

3. AST → HWPX 매핑
   - 각 블록 타입별로 전용 렌더러 사용:
     - `render_title(block)` → `<주제목>`용 표 + 스타일
     - `render_subtitle(block)` → `□`용 문단 + 위 여백용 줄
     - `render_body(block)` → `◦` 본문 문단 + 위 여백용 줄
     - `render_desc2(block)` → `-` 설명 문단 + 위 여백용 줄
     - `render_desc3(block)` → `*` 설명 문단 + 위 여백용 줄
     - `render_emphasis(block)` → `<강조>` 표 + 스타일

4. 파일 출력
   - 완성된 XML 트리를 `.hwpx` (ZIP + XML 구조) 포맷으로 저장.

---

## 6. spec_search.py 활용 포인트 (예시 커맨드 세트)

Phase1에서 HWPX XML을 구현할 때, 다음과 같은 쿼리를 자주 사용할 것으로 예상된다.

- 줄간격/문단 설정 관련:

```bash
python3 tools/spec_search.py "lineSpacing" --compact 2 -k 3
python3 tools/spec_search.py "paraPr 문단 모양" --compact 2 -k 5
```

- 글꼴/문자 모양 관련:

```bash
python3 tools/spec_search.py "charPr" --compact 2 -k 5
python3 tools/spec_search.py "font" --compact 2 -k 5
```

- 표/셀 관련 (주제목, 강조 박스 구현용):

```bash
python3 tools/spec_search.py "표 table 셀 cell" --compact 2 -k 5
python3 tools/spec_search.py "cell margin" --compact 2 -k 5
```

- 페이지 설정/여백 관련:

```bash
python3 tools/spec_search.py "page margin" --compact 2 -k 5
python3 tools/spec_search.py "페이지 설정" --compact 2 -k 5
```

이 커맨드들은 **예시**이며, 실제 구현 시에는 검색 결과를 참고하여 정확한 요소명/속성명(`paraPr`, `lineSpacing@type`, `lineSpacing@value`, `cellMargin`, `pageMargin` 등)을 코드에 반영해야 한다.

---

## 7. 주의사항

- 이 문서는 현재 **날것 초안**이며, 실제 HWPX 출력이 `test_inputmodel.hwpx`와 육안으로 동일해지는 것을 확인한 뒤, 내용이 변경될 수 있다.
- 구현 과정에서 스펙 검색을 통해 발견한 추가 규칙/예외사항은 `converter/TROUBLESHOOTING.md` 및 이 문서에 반영하는 것을 목표로 한다.
